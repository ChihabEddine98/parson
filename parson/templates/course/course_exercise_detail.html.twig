{% extends 'base.html.twig' %}

{% block title %} {{ exercise.title }} {% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/courses.css') }}">
{% endblock %}

{% block body_content %}

    <div class="col-lg-12 mx-auto mt-3 pt-1">

        <div class="col-lg-12  ">

            <div class="col-lg-12  text-dark">

                <div class="row col-12 mb-3 courseImg">
                    <img style="height: 320px;object-fit: cover;" class="col-12" src="{{ asset('img/can_robots_beat_humans.jpg') }}" alt="">
                </div>

                <div class=" row col-lg-9 col-sm-10 courseDetails mx-auto px-5 mb-5">
                    <h1 class="courseTitle text-center"> {{ exercise.course.title }} </h1>
                </div>

                <div class="text-center row col-lg-12 col-sm-6 courseDetails  d-flex flex-row">

                    {# Info Auteur #}
                    <div class=" col col-lg-12 col-sm-6 my-2 d-flex flex-column">
                        <a href="{{ path('user_profile',{id: exercise.course.author.id}) }}">
                            <img src="{{ asset('img/profil_default_male.png') }}" class="userImg" alt="">
                        </a>
                        <a href="{{ path('user_profile',{id: exercise.course.author.id}) }}">
                            {{ exercise.course.author.fullname }}
                        </a>
                        <a href="{{ path('user_profile',{id: exercise.course.author.id}) }}" class="text-dark">
                            {{ exercise.course.author.email }}
                        </a>
                        <p>
                            Le {{ exercise.course.createdAt|date('d/m/Y') }} à {{ exercise.course.createdAt|date('H:i') }}
                        </p>
                    </div>

                </div>

                <hr class="divider">
                <div class="row ml-3">
                    <h2> Question :</h2>
                </div>
                <div class="row col-12 ml-3">
                    <h3> {{ exercise.question }} ?</h3>
                </div>

                <div class="row col-12 ml-3 mt-5">
                    <h3> Résoudre le probleme !</h3>
                </div>
                <hr>

                    <div class="alert" id="result">
                       <h5>
                           Bravooo !
                       </h5>
                    </div>


                <div class="row bg-dark text-light pt-4">
                    <ul id="instructions">
                        {% for key,instruction in exercise.solution|shuffle %}
                            <li class="row instruction" id="{{ instruction }}">
                                <h5 class="p-2 border border-light "> {{ instruction }} </h5>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <button id="btnSubmit">Valider</button>
{#                <div class="row col-3 mx-auto my-3 ">#}
{#                    <a href="" class="btn btn-success w-100"> Valider</a>#}
{#                </div>#}




                </div>

                <!-- <div class="btn_">
                    <a href="/register" class="btn"> Commencer ! </a>
                </div> -->

            </div>

        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
    <script>
        $( document ).ready(function() {

                $('#result').hide();

                var sortedItems = [];

                $("#instructions").sortable({
                    stop: function (e, ui) {
                        SetSortOrder();
                    },
                });
                $("#instructions").disableSelection();

                //Init the list items on load
                SetSortOrder();

                //Set the data-order attribute to the index
                function SetSortOrder() {
                    $("#instructions li").each(function (index, value) {
                        $(this).data("order", index);
                    });
                }

                //AJAX
                function SubmitData(items) {

                    $.ajax({
                        type: "POST",
                        url: "{{ path('exo_parson_submit') }}",
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify({ "items": items , "id":{{ exercise.id }} }),
                    })//done handler
                        .done(function (data) {
                            var msg=data.result ? 'Bravoo ! c\'est le bon code !': 'Ooops ! retentez !';
                            if (data.result)
                            {
                                $('#result').addClass('alert-success').removeClass('alert-danger');
                            }
                            else
                            {
                                $('#result').addClass('alert-danger').removeClass('alert-success');

                            }
                            $('#result h5').text(msg);
                            $('#result').show();

                            console.log(data.d);
                        });
                }

                //Get the current order state
                function PopulateSortItems() {
                    sortedItems.length = 0;

                    $("#instructions li").each(function (index, value) {
                        let item = $(this).attr("id");

                       // item.id = $(this).attr("id");
                        // item.order = $(this).data("order");
                        sortedItems.push(item);
                    });

                    return sortedItems
                }

                //For debugging
                $('#btnSubmit').click(function () {
                    var items = PopulateSortItems();
                    SubmitData(items);
                });
            // $('#instructions').sortable({
            //     stop:function(event, ui){
            //         var element_dd = ui.item[0].attributes.element.value,
            //             position = ui.item.index(),
            //             link = base_url+'/update/post/'+element_dd;
            //         $.ajax({
            //             type:"POST",
            //             url:link,
            //             data:{
            //                 'position':position
            //             },
            //             success:function(result){
            //                 console.log(result);
            //             },
            //             error:function(error){
            //
            //             }
            //         });
            //     }
            // });

            {#$(function () {#}
            {#    $("#instructions").sortable({#}
            {#        update: function (event, ui) {#}
            {#            var order = $("#instructions").sortable("serialize", {#}
            {#                attribute: "id"#}
            {#            });#}

            {#            $(document).on("click", "button", function () { //that doesn't work#}
            {#                $.ajax({#}
            {#                    data: order,#}
            {#                    type: 'POST',#}
            {#                    dataType:json,#}
            {#                    url: "{{ path('exo_parson_submit') }}"#}
            {#                });#}
            {#            });#}

            {#        }#}
            {#    }).disableSelection();#}
            {#    $('button').on('click', function () {#}
            {#        var r = $("#instructions").sortable("toArray");#}
            {#        var a = $("#instructions").sortable("serialize", {#}
            {#            attribute: "id"#}
            {#        });#}
            {#        #}{#$.ajax(#}{#}#}
            {#        #}{#    data: r,#}
            {#        #}{#    type: 'POST',#}
            {#        #}{#    url: "{{ path('exo_parson_submit') }}"#}
            {#        #}{#});#}
            {#        console.log(r);#}
            {#    });#}
            {#});#}

        });

    </script>
{% endblock %}

